name: Publish Artifacts

on:
  push:
  release:
    types: ['published']

jobs:
  publish-container-image:
    uses: datum-cloud/actions/.github/workflows/publish-docker.yaml@v1.1.0
    with:
      image-name: telemetry-services-operator
    secrets: inherit

  publish-kustomize-bundles:
    permissions:
      id-token: write
      contents: read
      packages: write
    strategy:
      matrix:
        bundles:
          - name: ghcr.io/datum-cloud/telemetry-services-operator/telemetry-services-crds
            path: config/crd
          - name: ghcr.io/datum-cloud/telemetry-services-operator/vector-telemetry-exporter
            path: config/vector
          - name: ghcr.io/datum-cloud/telemetry-services-operator/telemetry-services-operator-kustomize
            path: config/default
    uses: datum-cloud/actions/.github/workflows/publish-kustomize-bundle.yaml@v1.1.0
    with:
      bundle-name: ${{ matrix.bundles.name }}
      bundle-path: ${{ matrix.bundles.path }}
    secrets: inherit
